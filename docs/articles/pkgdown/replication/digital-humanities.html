<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Replication: Text Analysis with R for Students of Literature • quanteda</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../../bootstrap-toc.css">
<script src="../../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../../pkgdown.css" rel="stylesheet">
<script src="../../../pkgdown.js"></script><!-- docsearch --><script src="../../../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../../../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../../../extra.css" rel="stylesheet">
<script src="../../../extra.js"></script><meta property="og:title" content="Replication: Text Analysis with R for Students of Literature">
<meta property="og:description" content="quanteda">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-144616-24"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-144616-24');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../../index.html">quanteda</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Quick Start
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/quickstart.html">Quick Start Guide</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/quickstart_es.html">Guía de Inicio Rápido</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/quickstart_cn.html">快速入门指南</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/quickstart_ja.html">クイック・スタートガイド</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Features
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/pkgdown/comparison.html">Feature comparison</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/design.html">Package design</a>
    </li>
    <li>
      <a href="../../../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/pkgdown/examples/phrase.html">Multi-word expressions</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/plotting.html">Textual data visualization</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/lsa.html">Latent Semantic Analysis (LSA)</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/chinese.html">Chinese text analysis</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/twitter.html">Social media analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Replications
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/pkgdown/replication/digital-humanities.html">Text Analysis with R for Students of Literature</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/replication/text2vec.html">Word embedding (word2vec)</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/replication/qss.html">Quantitative Social Science Ch. 5.1</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/quanteda/quanteda">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Replication: Text Analysis with R for Students of Literature</h1>
                        <h4 class="author">Kenneth Benoit, Stefan Müller, and Paul Nulty</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/quanteda/quanteda/blob/master/vignettes/pkgdown/replication/digital-humanities.Rmd"><code>vignettes/pkgdown/replication/digital-humanities.Rmd</code></a></small>
      <div class="hidden name"><code>digital-humanities.Rmd</code></div>

    </div>

    
    
<p>In this vignette we show how the <strong>quanteda</strong> package can be used to replicate the analysis from Matthew Jockers’ book <a href="http://doi.org/10.1007/978-3-319-03164-4"><em>Text Analysis with R for Students of Literature</em></a> (London: Springer, 2014). Most of the Jockers book consists of loading, transforming, and analyzing quantities derived from text and data from text. Because <strong>quanteda</strong> has built in most of the code to perform these data transformations and analyses, it makes it possible to replicate the results from the book with far less code. Throughout this vignette, we name objects based on Jockers’ book, but follow the <strong>quanteda</strong> <a href="https://github.com/quanetda/quanteda/wiki/Style-guide">style guide</a>.</p>
<p>In what follows, each section corresponds to the respective chapter in the book.</p>
<div id="r-basics" class="section level1">
<h1 class="hasAnchor">
<a href="#r-basics" class="anchor"></a>1 R Basics</h1>
<p>Our closest equivalent is simply:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"quanteda"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"readtext"</span>)</pre></body></html></div>
<p>But if you are reading this vignette, than chances are that you have already completed this step.</p>
</div>
<div id="first-foray" class="section level1">
<h1 class="hasAnchor">
<a href="#first-foray" class="anchor"></a>2 First Foray</h1>
<div id="loading-the-first-text-file" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-the-first-text-file" class="anchor"></a>2.1 Loading the first text file</h2>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">quanteda</span>)</pre></body></html></div>
<p>We can load the text from <em>Moby Dick</em> using the <strong>readtext</strong> package, directly from the <a href="https://www.gutenberg.org/ebooks/2701">Project Gutenberg website</a>.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">readtext</span>)
<span class="no">data_char_mobydick</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/texts.html">texts</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext</a></span>(<span class="st">"http://www.gutenberg.org/cache/epub/2701/pg2701.txt"</span>))
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">data_char_mobydick</span>) <span class="kw">&lt;-</span> <span class="st">"Moby Dick"</span></pre></body></html></div>
<p>The <code><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext()</a></code> function from the <strong>readtext</strong> package loads the text files into a <code>data.frame</code> object. We can access the text from a <code>data.frame</code> object (and also, as we will see, a <code>corpus</code> class object), using the <code><a href="../../../reference/texts.html">texts()</a></code> or the <code><a href="../../../reference/View.html">View()</a></code> method. Here we will display just the first 75 characters, to prevent a massive dump of the text of the entire novel. We do this using the <code><a href="https://rdrr.io/pkg/stringi/man/stri_sub.html">stri_sub()</a></code> function from the <strong>stringi</strong> package, which shows the 1st through the 75th characters of the texts of our new object <code>data_char_mobydick</code>. Because we have not assigned the return from this command to any object, it invokes a print method for character objects, and is displayed on the screen.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">stringi</span>)
<span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_sub.html">stri_sub</a></span>(<span class="no">data_char_mobydick</span>, <span class="fl">1</span>, <span class="fl">75</span>)</pre></body></html></div>
<pre><code>## [1] "The Project Gutenberg EBook of Moby Dick; or The Whale, by Herman Melville\n"</code></pre>
</div>
<div id="separate-content-from-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#separate-content-from-metadata" class="anchor"></a>2.2 Separate content from metadata</h2>
<p>The Gutenburg edition of the text contains some metadata before and after the text of the novel. The code below uses the <code>regexec</code> and <code>substring</code> functions to separate this from the text.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># extract the header information</span>
(<span class="no">start_v</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_locate.html">stri_locate_first_fixed</a></span>(<span class="no">data_char_mobydick</span>, <span class="st">"CHAPTER 1. Loomings."</span>)[<span class="fl">1</span>])</pre></body></html></div>
<pre><code>## [1] 23018</code></pre>
<div class="sourceCode" id="cb8"><html><body><pre class="r">(<span class="no">end_v</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_locate.html">stri_locate_last_fixed</a></span>(<span class="no">data_char_mobydick</span>, <span class="st">"orphan."</span>)[<span class="fl">1</span>])</pre></body></html></div>
<pre><code>## [1] 1216393</code></pre>
<p>Here, we found the character index of the beginning and end of the novel, rather than counting the lines as in the book, but the result will be very similar. If we want to verify that “orphan.” is the end of the novel, we can use the <code><a href="../../../reference/kwic.html">kwic()</a></code> function:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co"># verify that "orphan" is the end of the novel</span>
<span class="fu"><a href="../../../reference/kwic.html">kwic</a></span>(<span class="no">data_char_mobydick</span>, <span class="st">"orphan"</span>)</pre></body></html></div>
<pre><code>##                                                             
##  [Moby Dick, 253627] children, only found another | orphan |
##                              
##  . End of Project Gutenberg's</code></pre>
<p>If we want to count the number of lines, we can do so by counting the newlines in the text.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_count.html">stri_count_fixed</a></span>(<span class="no">data_char_mobydick</span>, <span class="st">"\n"</span>)</pre></body></html></div>
<pre><code>## [1] 22107</code></pre>
<p>To measure just the number lines in the novel itself, without the metadata, we can subset the text from the start and end of the novel part, as identified above.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_sub.html">stri_sub</a></span>(<span class="no">data_char_mobydick</span>, <span class="kw">from</span> <span class="kw">=</span> <span class="no">start_v</span>, <span class="kw">to</span> <span class="kw">=</span> <span class="no">end_v</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_count.html">stri_count_fixed</a></span>(<span class="st">"\n"</span>)</pre></body></html></div>
<pre><code>## [1] 21206</code></pre>
<p>To trim the non-book content, we use <code><a href="https://rdrr.io/pkg/stringi/man/stri_sub.html">stri_sub()</a></code> to extract the text between the beginning and ending indexes found above:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">novel_v</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_sub.html">stri_sub</a></span>(<span class="no">data_char_mobydick</span>, <span class="no">start_v</span>, <span class="no">end_v</span>)
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">novel_v</span>)</pre></body></html></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_sub.html">stri_sub</a></span>(<span class="no">novel_v</span>, <span class="fl">1</span>, <span class="fl">94</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>()</pre></body></html></div>
<pre><code>## CHAPTER 1. Loomings.
## 
## 
## Call me Ishmael. Some years ago--never mind how long precisely--having</code></pre>
</div>
<div id="reprocessing-the-content" class="section level2">
<h2 class="hasAnchor">
<a href="#reprocessing-the-content" class="anchor"></a>2.3 Reprocessing the content</h2>
<p>We begin processing the text by converting to lower case. <strong>quanteda</strong>’s <code>*_tolower()</code> functions work like the built-in <code><a href="https://rdrr.io/r/base/chartr.html">tolower()</a></code>, with an extra option to preserve upper-case acronyms when detected. For <code>character</code> objects, we use <code><a href="../../../reference/char_tolower.html">char_tolower()</a></code>:</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="co"># lowercase text</span>
<span class="no">novel_lower_v</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/char_tolower.html">char_tolower</a></span>(<span class="no">novel_v</span>)</pre></body></html></div>
<p><strong>quanteda</strong>’s <code><a href="../../../reference/tokens.html">tokens()</a></code> function splits the text into words, with many options available for which characters should be preserved, and which should be used to define word boundaries. The default behaviour works similarly to splitting on the regular expression for non-word characters (<code>\W</code> as in the book), but it much smarter. For instance, it does not treat apostrophes as word boundaries, meaning that <code>'s</code> and <code>'t</code> are not treated as whole words from possessive forms and contractions.</p>
<p>We will skip straight to getting the character vector of tokens:</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">moby_word_v</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/tokens.html">tokens</a></span>(<span class="no">novel_lower_v</span>, <span class="kw">remove_punct</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>()
(<span class="no">total_length</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">moby_word_v</span>))</pre></body></html></div>
<pre><code>## [1] 209999</code></pre>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">moby_word_v</span>[<span class="fl">1</span>:<span class="fl">10</span>]</pre></body></html></div>
<pre><code>##  [1] "chapter"  "1"        "loomings" "call"     "me"       "ishmael" 
##  [7] "some"     "years"    "ago"      "never"</code></pre>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">moby_word_v</span>[<span class="fl">99986</span>]</pre></body></html></div>
<pre><code>## [1] "in"</code></pre>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">moby_word_v</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>)]</pre></body></html></div>
<pre><code>## [1] "call"    "me"      "ishmael"</code></pre>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="co"># check positions of "whale"</span>
<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">moby_word_v</span> <span class="kw">==</span> <span class="st">"whale"</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</pre></body></html></div>
<pre><code>## [1] 2030 2060 2203 2415 4048 4211</code></pre>
</div>
<div id="beginning-the-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#beginning-the-analysis" class="anchor"></a>2.4 Beginning the analysis</h2>
<p>The code below uses the tokenized text to the occurrence of the word <em>whale</em>. To include the possessive form <em>whale’s</em>, we may sum the counts of both forms, count the keyword-in-context matches by regular expression or glob. A <em>glob</em> is a simple wildcard matching pattern common on Unix systems – asterisks match zero or more characters.</p>
<p>Note that the counts below do not match those in the book, due to differences in how the book has split on any non-word character, while <strong>quanteda</strong>’s tokenizer splits on a more comprehensive set of “word boundaries”. <strong>quanteda</strong>’s <code><a href="../../../reference/tokens.html">tokens()</a></code> function by default does not remove punctuation or numbers (both defined as “non-word” characters) by default. To more closely match the counts in the book, we have removed punctuation.</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">moby_word_v</span>[<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">moby_word_v</span> <span class="kw">==</span> <span class="st">"whale"</span>)])</pre></body></html></div>
<pre><code>## [1] 908</code></pre>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="co"># total occurrences of "whale" including possessive</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">moby_word_v</span>[<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">moby_word_v</span> <span class="kw">==</span> <span class="st">"whale"</span>)]) + <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">moby_word_v</span>[<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">moby_word_v</span> <span class="kw">==</span> <span class="st">"whale's"</span>)])</pre></body></html></div>
<pre><code>## [1] 1028</code></pre>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="co"># same thing using kwic()</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="fu"><a href="../../../reference/kwic.html">kwic</a></span>(<span class="no">novel_lower_v</span>, <span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"whale"</span>))</pre></body></html></div>
<pre><code>## [1] 908</code></pre>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="fu"><a href="../../../reference/kwic.html">kwic</a></span>(<span class="no">novel_lower_v</span>, <span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"whale*"</span>)) <span class="co"># includes words like "whalemen"</span></pre></body></html></div>
<pre><code>## [1] 1565</code></pre>
<div class="sourceCode" id="cb39"><html><body><pre class="r">(<span class="no">total_whale_hits</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="fu"><a href="../../../reference/kwic.html">kwic</a></span>(<span class="no">novel_lower_v</span>, <span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"^whale('s){0,1}$"</span>, <span class="kw">valuetype</span> <span class="kw">=</span> <span class="st">"regex"</span>)))</pre></body></html></div>
<pre><code>## [1] 1028</code></pre>
<p>What fraction of the total words (excluding punctuation) in the novel are “whale”?</p>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="no">total_whale_hits</span> / <span class="fu"><a href="../../../reference/ntoken.html">ntoken</a></span>(<span class="no">novel_lower_v</span>, <span class="kw">remove_punct</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>##       text1 
## 0.004895261</code></pre>
<p>With <code><a href="../../../reference/ntoken.html">ntype()</a></code> we can calculate the size of the vocabulary – includes possessive forms, but excludes punctuation, symbols and numbers.</p>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="co"># total unique words</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">moby_word_v</span>))</pre></body></html></div>
<pre><code>## [1] 18525</code></pre>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="fu"><a href="../../../reference/ntoken.html">ntype</a></span>(<span class="fu"><a href="../../../reference/char_tolower.html">char_tolower</a></span>(<span class="no">novel_v</span>), <span class="kw">remove_punct</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>## text1 
## 18525</code></pre>
<p>To quickly sort the word types by their frequency, we can use the <code><a href="../../../reference/dfm.html">dfm()</a></code> command to create a matrix of counts of each word type – a document-frequency matrix. In this case there is only one document, the entire book.</p>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="co"># ten most frequent words</span>
<span class="no">moby_dfm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/dfm.html">dfm</a></span>(<span class="no">novel_lower_v</span>, <span class="kw">remove_punct</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">moby_dfm</span>, <span class="kw">nf</span> <span class="kw">=</span> <span class="fl">10</span>)</pre></body></html></div>
<pre><code>## Document-feature matrix of: 1 document, 10 features (0.0% sparse).
##        features
## docs    chapter 1 loomings call  me ishmael some years ago never
##   text1     172 2        1   54 628      19  608    91  35   203</code></pre>
<p>Getting the list of the most frequent 10 terms is easy, using <code><a href="../../../reference/textstat_frequency.html">textstat_frequency()</a></code>.</p>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="fu"><a href="../../../reference/textstat_frequency.html">textstat_frequency</a></span>(<span class="no">moby_dfm</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">10</span>)</pre></body></html></div>
<pre><code>##    feature frequency rank docfreq group
## 1      the     14173    1       1   all
## 2       of      6446    2       1   all
## 3      and      6311    3       1   all
## 4        a      4605    4       1   all
## 5       to      4511    5       1   all
## 6       in      4071    6       1   all
## 7     that      2950    7       1   all
## 8      his      2495    8       1   all
## 9       it      2394    9       1   all
## 10       i      1976   10       1   all</code></pre>
<p>Finally, if we wish to plot the most frequent (50) terms, we can supply the results of <code><a href="../../../reference/textstat_frequency.html">textstat_frequency()</a></code> to <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> to plot their frequency by their rank:</p>
<div class="sourceCode" id="cb51"><html><body><pre class="r"><span class="co"># plot frequency of 50 most frequent terms </span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>())
<span class="fu"><a href="../../../reference/textstat_frequency.html">textstat_frequency</a></span>(<span class="no">moby_dfm</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">50</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">rank</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">frequency</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Frequency rank"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Term frequency"</span>)</pre></body></html></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-17-1.png" width="768"></p>
<p>For direct comparison with the next chapter, we also create the sorted list of the most frequently found words using this:</p>
<div class="sourceCode" id="cb52"><html><body><pre class="r"><span class="no">sorted_moby_freqs_t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/topfeatures.html">topfeatures</a></span>(<span class="no">moby_dfm</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fu"><a href="../../../reference/ndoc.html">nfeat</a></span>(<span class="no">moby_dfm</span>))</pre></body></html></div>
</div>
</div>
<div id="accessing-and-comparing-word-frequency-data" class="section level1">
<h1 class="hasAnchor">
<a href="#accessing-and-comparing-word-frequency-data" class="anchor"></a>3 Accessing and Comparing Word Frequency Data</h1>
<div id="accessing-word-data" class="section level2">
<h2 class="hasAnchor">
<a href="#accessing-word-data" class="anchor"></a>3.1 Accessing Word Data</h2>
<p>We can query the document-frequency matrix to retrieve word frequencies, as with a normal matrix:</p>
<div class="sourceCode" id="cb53"><html><body><pre class="r"><span class="co"># frequencies of "he" and "she" - these are matrixes, not numerics</span>
<span class="no">sorted_moby_freqs_t</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"he"</span>, <span class="st">"she"</span>, <span class="st">"him"</span>, <span class="st">"her"</span>)]</pre></body></html></div>
<pre><code>##   he  she  him  her 
## 1758  112 1058  330</code></pre>
<div class="sourceCode" id="cb55"><html><body><pre class="r"><span class="co"># another method: indexing the dfm</span>
<span class="no">moby_dfm</span>[, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"he"</span>, <span class="st">"she"</span>, <span class="st">"him"</span>, <span class="st">"her"</span>)]</pre></body></html></div>
<pre><code>## Document-feature matrix of: 1 document, 4 features (0.0% sparse).
##        features
## docs      he she  him her
##   text1 1758 112 1058 330</code></pre>
<div class="sourceCode" id="cb57"><html><body><pre class="r"><span class="no">sorted_moby_freqs_t</span>[<span class="fl">1</span>]</pre></body></html></div>
<pre><code>##   the 
## 14173</code></pre>
<div class="sourceCode" id="cb59"><html><body><pre class="r"><span class="no">sorted_moby_freqs_t</span>[<span class="st">"the"</span>]</pre></body></html></div>
<pre><code>##   the 
## 14173</code></pre>
<div class="sourceCode" id="cb61"><html><body><pre class="r"><span class="co"># term frequency ratios</span>
<span class="no">sorted_moby_freqs_t</span>[<span class="st">"him"</span>] / <span class="no">sorted_moby_freqs_t</span>[<span class="st">"her"</span>]</pre></body></html></div>
<pre><code>##      him 
## 3.206061</code></pre>
<div class="sourceCode" id="cb63"><html><body><pre class="r"><span class="no">sorted_moby_freqs_t</span>[<span class="st">"he"</span>] / <span class="no">sorted_moby_freqs_t</span>[<span class="st">"she"</span>]</pre></body></html></div>
<pre><code>##       he 
## 15.69643</code></pre>
<p>Total number of tokens:</p>
<div class="sourceCode" id="cb65"><html><body><pre class="r"><span class="fu"><a href="../../../reference/ntoken.html">ntoken</a></span>(<span class="no">moby_dfm</span>)</pre></body></html></div>
<pre><code>##  text1 
## 209999</code></pre>
<div class="sourceCode" id="cb67"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">sorted_moby_freqs_t</span>)</pre></body></html></div>
<pre><code>## [1] 209999</code></pre>
</div>
<div id="recycling" class="section level2">
<h2 class="hasAnchor">
<a href="#recycling" class="anchor"></a>3.2 Recycling</h2>
<p>Relative term frequencies:</p>
<div class="sourceCode" id="cb69"><html><body><pre class="r"><span class="no">sorted_moby_rel_freqs_t</span> <span class="kw">&lt;-</span> <span class="no">sorted_moby_freqs_t</span> / <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">sorted_moby_freqs_t</span>) * <span class="fl">100</span>
<span class="no">sorted_moby_rel_freqs_t</span>[<span class="st">"the"</span>]</pre></body></html></div>
<pre><code>##     the 
## 6.74908</code></pre>
<div class="sourceCode" id="cb71"><html><body><pre class="r"><span class="co"># by weighting the dfm directly</span>
<span class="no">moby_dfm_pct</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_weight.html">dfm_weight</a></span>(<span class="no">moby_dfm</span>, <span class="kw">scheme</span> <span class="kw">=</span> <span class="st">"prop"</span>) * <span class="fl">100</span>

<span class="fu"><a href="../../../reference/dfm_select.html">dfm_select</a></span>(<span class="no">moby_dfm_pct</span>, <span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"the"</span>)</pre></body></html></div>
<pre><code>## Document-feature matrix of: 1 document, 1 feature (0.0% sparse).
##        features
## docs        the
##   text1 6.74908</code></pre>
<p>Plotting the most frequent terms, replicating the plot from the book:</p>
<div class="sourceCode" id="cb73"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">sorted_moby_rel_freqs_t</span>[<span class="fl">1</span>:<span class="fl">10</span>], <span class="kw">type</span> <span class="kw">=</span> <span class="st">"b"</span>,
     <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"Top Ten Words"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"Percentage of Full Text"</span>, <span class="kw">xaxt</span> <span class="kw">=</span> <span class="st">"n"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="fl">1</span>,<span class="fl">1</span>:<span class="fl">10</span>, <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">sorted_moby_rel_freqs_t</span>[<span class="fl">1</span>:<span class="fl">10</span>]))</pre></body></html></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>Plotting the most frequent terms using <strong>ggplot2</strong>:</p>
<div class="sourceCode" id="cb74"><html><body><pre class="r"><span class="fu"><a href="../../../reference/textstat_frequency.html">textstat_frequency</a></span>(<span class="no">moby_dfm_pct</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">10</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span>(<span class="no">feature</span>, -<span class="no">rank</span>), <span class="kw">y</span> <span class="kw">=</span> <span class="no">frequency</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span>(<span class="kw">stat</span> <span class="kw">=</span> <span class="st">"identity"</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Term Frequency as a Percentage"</span>)</pre></body></html></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
</div>
<div id="token-distribution-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#token-distribution-analysis" class="anchor"></a>4 Token Distribution Analysis</h1>
<div id="dispersion-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#dispersion-plots" class="anchor"></a>4.1 Dispersion plots</h2>
<p>A dispersion plot allows us to visualize the occurrences of particular terms throughout the text. The object returned by the <code>kwic</code> function can be plotted to display a dispersion plot. The <strong>quanteda</strong> <code>textplot_</code> objects are based on <strong>ggplot2</strong>, so you can easily change the plot, for example by adding custom title.</p>
<div class="sourceCode" id="cb75"><html><body><pre class="r"><span class="co"># using words from tokenized corpus for dispersion</span>
<span class="fu"><a href="../../../reference/textplot_xray.html">textplot_xray</a></span>(<span class="fu"><a href="../../../reference/kwic.html">kwic</a></span>(<span class="no">novel_v</span>, <span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"whale"</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Lexical dispersion"</span>)</pre></body></html></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-24-1.png" width="768"></p>
<p>To produce multiple dispersion plots for comparison, you can simply send more than one <code><a href="../../../reference/kwic.html">kwic()</a></code> output to <code><a href="../../../reference/textplot_xray.html">textplot_xray()</a></code>:</p>
<div class="sourceCode" id="cb76"><html><body><pre class="r"><span class="fu"><a href="../../../reference/textplot_xray.html">textplot_xray</a></span>(
    <span class="fu"><a href="../../../reference/kwic.html">kwic</a></span>(<span class="no">novel_v</span>, <span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"whale"</span>),
    <span class="fu"><a href="../../../reference/kwic.html">kwic</a></span>(<span class="no">novel_v</span>, <span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"Ahab"</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Lexical dispersion"</span>)</pre></body></html></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-25-1.png" width="768"></p>
</div>
<div id="searching-with-regular-expression" class="section level2">
<h2 class="hasAnchor">
<a href="#searching-with-regular-expression" class="anchor"></a>4.2 Searching with regular expression</h2>
<div class="sourceCode" id="cb77"><html><body><pre class="r"><span class="co"># identify the chapter break locations</span>
<span class="no">chap_positions_v</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/kwic.html">kwic</a></span>(<span class="no">novel_v</span>, <span class="fu"><a href="../../../reference/phrase.html">phrase</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"CHAPTER \\d"</span>)), <span class="kw">valuetype</span> <span class="kw">=</span> <span class="st">"regex"</span>)$<span class="no">from</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">chap_positions_v</span>)</pre></body></html></div>
<pre><code>## [1]     1  2554  4242 11127 13041 13908</code></pre>
</div>
<div id="identifying-chapter-breaks" class="section level2">
<h2 class="hasAnchor">
<a href="#identifying-chapter-breaks" class="anchor"></a>4.2 Identifying chapter breaks</h2>
<p>Splitting the text into chapters means that we will have a collection of documents, which makes this a good time to make a <code>corpus</code> object to hold the texts. Initially, we make a single-document corpus, and then use the <code><a href="../../../reference/corpus_segment.html">char_segment()</a></code> function to split this by the string which specifies the chapter breaks.</p>
<div class="sourceCode" id="cb79"><html><body><pre class="r"><span class="no">chapters_corp</span> <span class="kw">&lt;-</span>
    <span class="fu"><a href="../../../reference/corpus.html">corpus</a></span>(<span class="no">data_char_mobydick</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../../../reference/corpus_segment.html">corpus_segment</a></span>(<span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"CHAPTER\\s\\d+.*\\n"</span>, <span class="kw">valuetype</span> <span class="kw">=</span> <span class="st">"regex"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">chapters_corp</span>, <span class="fl">10</span>)</pre></body></html></div>
<pre><code>## Corpus consisting of 136 documents, showing 10 documents:
## 
##          Text Types Tokens Sentences                       pattern
##   Moby Dick.1   917   2548       101        CHAPTER 1. Loomings.\n
##   Moby Dick.2   651   1682        60  CHAPTER 2. The Carpet-Bag.\n
##   Moby Dick.3  1744   6879       264 CHAPTER 3. The Spouter-Inn.\n
##   Moby Dick.4   681   1908        54 CHAPTER 4. The Counterpane.\n
##   Moby Dick.5   405    862        29       CHAPTER 5. Breakfast.\n
##   Moby Dick.6   464    936        44      CHAPTER 6. The Street.\n
##   Moby Dick.7   519   1078        40      CHAPTER 7. The Chapel.\n
##   Moby Dick.8   478   1076        29      CHAPTER 8. The Pulpit.\n
##   Moby Dick.9  1260   4250       166      CHAPTER 9. The Sermon.\n
##  Moby Dick.10   658   1791        66 CHAPTER 10. A Bosom Friend.\n</code></pre>
<p>The titles are automatically extracted into the <code>pattern</code> document variables, and the text of each chapter becomes the text of each new document unit. To tidy this up, we can remove the trailing <code>\n</code> character, using <code><a href="https://rdrr.io/pkg/stringi/man/stri_trim.html">stri_trim_right()</a></code>, since the <code>\n</code> is a member of the “whitespace” group.</p>
<div class="sourceCode" id="cb81"><html><body><pre class="r"><span class="fu"><a href="../../../reference/docvars.html">docvars</a></span>(<span class="no">chapters_corp</span>, <span class="st">"pattern"</span>) <span class="kw">&lt;-</span> <span class="kw pkg">stringi</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_trim.html">stri_trim_right</a></span>(<span class="fu"><a href="../../../reference/docvars.html">docvars</a></span>(<span class="no">chapters_corp</span>, <span class="st">"pattern"</span>))
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">chapters_corp</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">3</span>)</pre></body></html></div>
<pre><code>## Corpus consisting of 136 documents, showing 3 documents:
## 
##         Text Types Tokens Sentences                     pattern
##  Moby Dick.1   917   2548       101        CHAPTER 1. Loomings.
##  Moby Dick.2   651   1682        60  CHAPTER 2. The Carpet-Bag.
##  Moby Dick.3  1744   6879       264 CHAPTER 3. The Spouter-Inn.</code></pre>
<p>For better reference, let’s also rename the document labels with these chapter headings:</p>
<div class="sourceCode" id="cb83"><html><body><pre class="r"><span class="fu"><a href="../../../reference/docnames.html">docnames</a></span>(<span class="no">chapters_corp</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/docvars.html">docvars</a></span>(<span class="no">chapters_corp</span>, <span class="st">"pattern"</span>)</pre></body></html></div>
<div id="barplots-of-whale-and-ahab" class="section level3">
<h3 class="hasAnchor">
<a href="#barplots-of-whale-and-ahab" class="anchor"></a>4.4.5 barplots of whale and ahab</h3>
<p>With the corpus split into chapters, we can use the <code><a href="../../../reference/dfm.html">dfm()</a></code> function to create a matrix of counts of each word in each chapter – a document-frequency matrix.</p>
<div class="sourceCode" id="cb84"><html><body><pre class="r"><span class="co"># create a dfm</span>
<span class="no">chap_dfm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/dfm.html">dfm</a></span>(<span class="no">chapters_corp</span>)

<span class="co"># extract row with count for "whale"/"ahab" in each chapter</span>
<span class="co"># and convert to data frame for plotting</span>
<span class="no">whales_ahabs_df</span> <span class="kw">&lt;-</span> <span class="no">chap_dfm</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../../../reference/dfm_select.html">dfm_keep</a></span>(<span class="kw">pattern</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"whale"</span>, <span class="st">"ahab"</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../../../reference/convert.html">convert</a></span>(<span class="kw">to</span> <span class="kw">=</span> <span class="st">"data.frame"</span>)

<span class="no">whales_ahabs_df</span>$<span class="no">chapter</span> <span class="kw">&lt;-</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">whales_ahabs_df</span>)

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">whales_ahabs_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">chapter</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">whale</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span>(<span class="kw">stat</span> <span class="kw">=</span> <span class="st">"identity"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Chapter"</span>,
         <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Frequency"</span>,
         <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Occurrence of "whale"'</span>)</pre></body></html></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-30-1.png" width="768"></p>
<div class="sourceCode" id="cb85"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">whales_ahabs_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">chapter</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">ahab</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span>(<span class="kw">stat</span> <span class="kw">=</span> <span class="st">"identity"</span>) +
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Chapter"</span>,
         <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Frequency"</span>,
         <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Occurrence of "ahab"'</span>)</pre></body></html></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-30-2.png" width="768"></p>
<p>The above plots are raw frequency plots. For relative frequency plots, (word count divided by the length of the chapter) we can weight the document-frequency matrix. To obtain expected word frequency per 100 words, we multiply by 100. To get a feel for what the resulting weighted dfm (document-feature matrix) looks like, you can inspect it with the <code>head</code> function, which prints the first few rows and columns.</p>
<div class="sourceCode" id="cb86"><html><body><pre class="r"><span class="no">rel_dfm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_weight.html">dfm_weight</a></span>(<span class="no">chap_dfm</span>, <span class="kw">scheme</span> <span class="kw">=</span> <span class="st">"prop"</span>) * <span class="fl">100</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">rel_dfm</span>)</pre></body></html></div>
<pre><code>## Document-feature matrix of: 6 documents, 18,629 features (95.9% sparse) and 1 docvar.
##                              features
## docs                                call        me    ishmael        .
##   CHAPTER 1. Loomings.        0.03924647 0.9811617 0.07849294 3.139717
##   CHAPTER 2. The Carpet-Bag.  0          0.3567182 0.23781213 2.675386
##   CHAPTER 3. The Spouter-Inn. 0.01453700 0.6396279 0          3.299898
##   CHAPTER 4. The Counterpane. 0          0.9958071 0          2.672956
##   CHAPTER 5. Breakfast.       0          0.1160093 0          3.016241
##   CHAPTER 6. The Street.      0          0.1068376 0          4.166667
##                              features
## docs                                some      years        ago         -
##   CHAPTER 1. Loomings.        0.43171115 0.03924647 0.07849294 1.0596546
##   CHAPTER 2. The Carpet-Bag.  0.05945303 0.05945303 0.05945303 1.0701546
##   CHAPTER 3. The Spouter-Inn. 0.24712894 0.05814799 0.01453700 0.9303678
##   CHAPTER 4. The Counterpane. 0.05241090 0          0          0.9958071
##   CHAPTER 5. Breakfast.       0.23201856 0          0          0.8120650
##   CHAPTER 6. The Street.      0.10683761 0          0          0.3205128
##                              features
## docs                              never       mind
##   CHAPTER 1. Loomings.        0.1962323 0.03924647
##   CHAPTER 2. The Carpet-Bag.  0         0.11890606
##   CHAPTER 3. The Spouter-Inn. 0.1599070 0.04361099
##   CHAPTER 4. The Counterpane. 0.1048218 0.05241090
##   CHAPTER 5. Breakfast.       0.1160093 0         
##   CHAPTER 6. The Street.      0         0         
## [ reached max_nfeat ... 18,619 more features ]</code></pre>
<div class="sourceCode" id="cb88"><html><body><pre class="r"><span class="co"># subset dfm and convert to data.frame object</span>
<span class="no">rel_chap_freq</span> <span class="kw">&lt;-</span> <span class="no">rel_dfm</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../../../reference/dfm_select.html">dfm_keep</a></span>(<span class="kw">pattern</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"whale"</span>, <span class="st">"ahab"</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../../../reference/convert.html">convert</a></span>(<span class="kw">to</span> <span class="kw">=</span> <span class="st">"data.frame"</span>)

<span class="no">rel_chap_freq</span>$<span class="no">chapter</span> <span class="kw">&lt;-</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">rel_chap_freq</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">rel_chap_freq</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">chapter</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">whale</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span>(<span class="kw">stat</span> <span class="kw">=</span> <span class="st">"identity"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Chapter"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Relative frequency"</span>,
         <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Occurrence of "whale"'</span>)</pre></body></html></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-31-1.png" width="768"></p>
<div class="sourceCode" id="cb89"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">rel_chap_freq</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">chapter</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">ahab</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span>(<span class="kw">stat</span> <span class="kw">=</span> <span class="st">"identity"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Chapter"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Relative frequency"</span>,
         <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Occurrence of "ahab"'</span>)</pre></body></html></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-31-2.png" width="768"></p>
</div>
</div>
</div>
<div id="correlation" class="section level1">
<h1 class="hasAnchor">
<a href="#correlation" class="anchor"></a>5 Correlation</h1>
<div id="correlation-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#correlation-analysis" class="anchor"></a>5.2 Correlation Analysis</h2>
<p>Correlation analysis (and many other similarity measures) can be constructed using fast, sparse means through the <code><a href="../../../reference/textstat_simil.html">textstat_simil()</a></code> function. Here, we select feature comparisons for just “whale” and “ahab”, and convert this into a matrix as in the book. Because correlations are sensitive to document length, we first convert this into a relative frequency using <code><a href="../../../reference/dfm_weight.html">dfm_weight()</a></code>.</p>
<div class="sourceCode" id="cb90"><html><body><pre class="r"><span class="fu"><a href="../../../reference/dfm_weight.html">dfm_weight</a></span>(<span class="no">chap_dfm</span>, <span class="kw">scheme</span> <span class="kw">=</span> <span class="st">"prop"</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../../../reference/textstat_simil.html">textstat_simil</a></span>(<span class="kw">selection</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"whale"</span>, <span class="st">"ahab"</span>), <span class="kw">method</span> <span class="kw">=</span> <span class="st">"correlation"</span>, <span class="kw">margin</span> <span class="kw">=</span> <span class="st">"features"</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">2</span>)</pre></body></html></div>
<pre><code>## Warning: 'selection' is deprecated. Use 'y' instead.</code></pre>
<pre><code>##           whale       ahab
## call  0.1203484 -0.1056474
## me   -0.2503967  0.1642701</code></pre>
<p>With the ahab frequency and whale frequency vectors extracted from the dfm, it is easy to calculate the significance of the correlation.</p>
</div>
<div id="testing-correlation-with-randomization" class="section level2">
<h2 class="hasAnchor">
<a href="#testing-correlation-with-randomization" class="anchor"></a>5.4 Testing Correlation with Randomization</h2>
<div class="sourceCode" id="cb93"><html><body><pre class="r"><span class="no">cor_data_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_weight.html">dfm_weight</a></span>(<span class="no">chap_dfm</span>, <span class="kw">scheme</span> <span class="kw">=</span> <span class="st">"prop"</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../../../reference/dfm_select.html">dfm_keep</a></span>(<span class="kw">pattern</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ahab"</span>, <span class="st">"whale"</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../../../reference/convert.html">convert</a></span>(<span class="kw">to</span> <span class="kw">=</span> <span class="st">"data.frame"</span>)

<span class="co"># sample 1000 replicates and create data frame</span>
<span class="no">n</span> <span class="kw">&lt;-</span> <span class="fl">1000</span>
<span class="no">samples</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
    <span class="kw">cor_sample</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="no">n</span>, <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="no">cor_data_df</span>$<span class="no">whale</span>), <span class="no">cor_data_df</span>$<span class="no">ahab</span>)),
    <span class="kw">id_sample</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="no">n</span>
)

<span class="co"># plot distribution of resampled correlations</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">samples</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">cor_sample</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">..density..</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">binwidth</span> <span class="kw">=</span> <span class="fl">0.01</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="st">"red"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Correlation Coefficient"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="kw">NULL</span>,
         <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Histogram of Random Correlation Coefficients with Normal Curve"</span>)</pre></body></html></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-33-1.png" width="768"></p>
</div>
</div>
<div id="measures-of-lexical-variety" class="section level1">
<h1 class="hasAnchor">
<a href="#measures-of-lexical-variety" class="anchor"></a>6 Measures of Lexical Variety</h1>
<div id="mean-word-frequency" class="section level2">
<h2 class="hasAnchor">
<a href="#mean-word-frequency" class="anchor"></a>6.2 Mean word frequency</h2>
<div class="sourceCode" id="cb94"><html><body><pre class="r"><span class="co"># length of the book in chapters</span>
<span class="fu"><a href="../../../reference/ndoc.html">ndoc</a></span>(<span class="no">chapters_corp</span>)</pre></body></html></div>
<pre><code>## [1] 136</code></pre>
<div class="sourceCode" id="cb96"><html><body><pre class="r"><span class="co"># chapter names</span>
<span class="fu"><a href="../../../reference/docnames.html">docnames</a></span>(<span class="no">chapters_corp</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</pre></body></html></div>
<pre><code>## [1] "CHAPTER 1. Loomings."        "CHAPTER 2. The Carpet-Bag." 
## [3] "CHAPTER 3. The Spouter-Inn." "CHAPTER 4. The Counterpane."
## [5] "CHAPTER 5. Breakfast."       "CHAPTER 6. The Street."</code></pre>
<p>Calculating the mean word frequencies is easy:</p>
<div class="sourceCode" id="cb98"><html><body><pre class="r"><span class="co"># for first few chapters</span>
<span class="fu"><a href="../../../reference/ntoken.html">ntoken</a></span>(<span class="no">chapters_corp</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</pre></body></html></div>
<pre><code>##        CHAPTER 1. Loomings.  CHAPTER 2. The Carpet-Bag. 
##                        2548                        1682 
## CHAPTER 3. The Spouter-Inn. CHAPTER 4. The Counterpane. 
##                        6879                        1908 
##       CHAPTER 5. Breakfast.      CHAPTER 6. The Street. 
##                         862                         936</code></pre>
<div class="sourceCode" id="cb100"><html><body><pre class="r"><span class="co"># average</span>
(<span class="fu"><a href="../../../reference/ntoken.html">ntoken</a></span>(<span class="no">chapters_corp</span>) / <span class="fu"><a href="../../../reference/ntoken.html">ntype</a></span>(<span class="no">chapters_corp</span>)) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</pre></body></html></div>
<pre><code>##        CHAPTER 1. Loomings.  CHAPTER 2. The Carpet-Bag. 
##                    2.778626                    2.583717 
## CHAPTER 3. The Spouter-Inn. CHAPTER 4. The Counterpane. 
##                    3.944381                    2.801762 
##       CHAPTER 5. Breakfast.      CHAPTER 6. The Street. 
##                    2.128395                    2.017241</code></pre>
</div>
<div id="extracting-word-usage-means" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-word-usage-means" class="anchor"></a>6.3 Extracting Word Usage Means</h2>
<p>Since the quotient of the number of tokens and number of types is a vector, we can simply feed this to <code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code> using the pipe operator:</p>
<div class="sourceCode" id="cb102"><html><body><pre class="r">(<span class="fu"><a href="../../../reference/ntoken.html">ntoken</a></span>(<span class="no">chapters_corp</span>) / <span class="fu"><a href="../../../reference/ntoken.html">ntype</a></span>(<span class="no">chapters_corp</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">"h"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"Mean word frequency"</span>)</pre></body></html></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-36-1.png" width="768"></p>
<p>For the scaled plot:</p>
<div class="sourceCode" id="cb103"><html><body><pre class="r">(<span class="fu"><a href="../../../reference/ntoken.html">ntoken</a></span>(<span class="no">chapters_corp</span>) / <span class="fu"><a href="../../../reference/ntoken.html">ntype</a></span>(<span class="no">chapters_corp</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">"h"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"Scaled mean word frequency"</span>)</pre></body></html></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-37-1.png" width="768"></p>
</div>
<div id="ranking-the-values" class="section level2">
<h2 class="hasAnchor">
<a href="#ranking-the-values" class="anchor"></a>6.4 Ranking the values</h2>
<div class="sourceCode" id="cb104"><html><body><pre class="r"><span class="no">mean_word_use_m</span> <span class="kw">&lt;-</span> (<span class="fu"><a href="../../../reference/ntoken.html">ntoken</a></span>(<span class="no">chapters_corp</span>) / <span class="fu"><a href="../../../reference/ntoken.html">ntype</a></span>(<span class="no">chapters_corp</span>))
<span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="no">mean_word_use_m</span>, <span class="kw">decreasing</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</pre></body></html></div>
<pre><code>##     CHAPTER 54. The Town-Ho's Story. CHAPTER 135. The Chase. - Third Day. 
##                             4.129814                             4.115981 
##                CHAPTER 16. The Ship.          CHAPTER 3. The Spouter-Inn. 
##                             4.015863                             3.944381 
##                CHAPTER 32. Cetology.          CHAPTER 64. Stubb's Supper. 
##                             3.524490                             3.451914</code></pre>
</div>
<div id="calculating-the-ttr" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-the-ttr" class="anchor"></a>6.5 Calculating the TTR</h2>
<p>Measures of lexical diversity can be estimated using <code><a href="../../../reference/textstat_lexdiv.html">textstat_lexdiv()</a></code>. The TTR (Type-Token Ratio), a measure used in section 6.5, can be calculated for each document of the <code>dfm</code>.</p>
<div class="sourceCode" id="cb106"><html><body><pre class="r"><span class="fu"><a href="../../../reference/dfm.html">dfm</a></span>(<span class="no">chapters_corp</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../../../reference/textstat_lexdiv.html">textstat_lexdiv</a></span>(<span class="kw">measure</span> <span class="kw">=</span> <span class="st">"TTR"</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">n</span> <span class="kw">=</span> <span class="fl">10</span>)</pre></body></html></div>
<pre><code>##                       document       TTR
## 1         CHAPTER 1. Loomings. 0.3824989
## 2   CHAPTER 2. The Carpet-Bag. 0.4295676
## 3  CHAPTER 3. The Spouter-Inn. 0.2803147
## 4  CHAPTER 4. The Counterpane. 0.3954189
## 5        CHAPTER 5. Breakfast. 0.5101215
## 6       CHAPTER 6. The Street. 0.5358025
## 7       CHAPTER 7. The Chapel. 0.5095745
## 8       CHAPTER 8. The Pulpit. 0.4846885
## 9       CHAPTER 9. The Sermon. 0.3310075
## 10 CHAPTER 10. A Bosom Friend. 0.3982017</code></pre>
</div>
</div>
<div id="hapax-richness" class="section level1">
<h1 class="hasAnchor">
<a href="#hapax-richness" class="anchor"></a>7 Hapax Richness</h1>
<p>Another measure of lexical diversity is Hapax richness, defined as the number of words that occur only once divided by the total number of words. We can calculate Hapax richness very simply by using a logical operation on the document-feature matrix, to return a logical value for each term that occurs once, and then sum these to get a count.</p>
<div class="sourceCode" id="cb108"><html><body><pre class="r"><span class="co"># hapaxes per document</span>
<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="no">chap_dfm</span> <span class="kw">==</span> <span class="fl">1</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</pre></body></html></div>
<pre><code>##        CHAPTER 1. Loomings.  CHAPTER 2. The Carpet-Bag. 
##                         609                         437 
## CHAPTER 3. The Spouter-Inn. CHAPTER 4. The Counterpane. 
##                        1084                         464 
##       CHAPTER 5. Breakfast.      CHAPTER 6. The Street. 
##                         276                         341</code></pre>
<div class="sourceCode" id="cb110"><html><body><pre class="r"><span class="co"># as a proportion</span>
<span class="no">hapax_proportion</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="no">chap_dfm</span> <span class="kw">==</span> <span class="fl">1</span>) / <span class="fu"><a href="../../../reference/ntoken.html">ntoken</a></span>(<span class="no">chap_dfm</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">hapax_proportion</span>)</pre></body></html></div>
<pre><code>##        CHAPTER 1. Loomings.  CHAPTER 2. The Carpet-Bag. 
##                   0.2390110                   0.2598098 
## CHAPTER 3. The Spouter-Inn. CHAPTER 4. The Counterpane. 
##                   0.1575810                   0.2431866 
##       CHAPTER 5. Breakfast.      CHAPTER 6. The Street. 
##                   0.3201856                   0.3643162</code></pre>
<p>To plot this:</p>
<div class="sourceCode" id="cb112"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span>(<span class="no">hapax_proportion</span>, <span class="kw">beside</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"grey"</span>, <span class="kw">names.arg</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fu"><a href="../../../reference/ndoc.html">ndoc</a></span>(<span class="no">chap_dfm</span>)))</pre></body></html></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-41-1.png" width="768"></p>
</div>
<div id="do-it-kwic" class="section level1">
<h1 class="hasAnchor">
<a href="#do-it-kwic" class="anchor"></a>8 Do it KWIC</h1>
<p>For this, and the next chapter, we simply use <strong>quanteda</strong>’s excellent <code><a href="../../../reference/kwic.html">kwic()</a></code> function. To find the indexes of the token positions for “gutenberg”, for instance, we use the following, which returns a data.frame with the name <code>from</code> indicating the index position of the start of the token match:</p>
<div class="sourceCode" id="cb113"><html><body><pre class="r"><span class="no">gutenberg_kwic</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/kwic.html">kwic</a></span>(<span class="no">data_char_mobydick</span>, <span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"gutenberg"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">gutenberg_kwic</span>$<span class="no">from</span>, <span class="fl">10</span>)</pre></body></html></div>
<pre><code>##  [1]      3     52    108 253650 253799 253910 253957 254145 254261 254359</code></pre>
</div>
<div id="do-it-kwic-better" class="section level1">
<h1 class="hasAnchor">
<a href="#do-it-kwic-better" class="anchor"></a>9 Do it KWIC (Better)</h1>
<p>This is going to be super easy since we don’t need to reinvent the wheel here, since <code><a href="../../../reference/kwic.html">kwic()</a></code> already does all that we need.</p>
<p>Let’s create a corpus containing <em>Moby Dick</em> but also Jane Austen’s <em>Sense and Sensibility</em>.</p>
<div class="sourceCode" id="cb115"><html><body><pre class="r"><span class="no">data_char_senseandsensibility</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/texts.html">texts</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext</a></span>(<span class="st">"http://www.gutenberg.org/files/161/161.txt"</span>))
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">data_char_senseandsensibility</span>) <span class="kw">&lt;-</span> <span class="st">"Sense and Sensibility"</span>

<span class="no">litcorpus</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/corpus.html">corpus</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">data_char_mobydick</span>, <span class="no">data_char_senseandsensibility</span>))</pre></body></html></div>
<p>Now we can use <code><a href="../../../reference/kwic.html">kwic()</a></code> to find out where in each novel this occurred:</p>
<div class="sourceCode" id="cb116"><html><body><pre class="r">(<span class="no">dogkwic</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/kwic.html">kwic</a></span>(<span class="no">litcorpus</span>, <span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"dog"</span>))</pre></body></html></div>
<pre><code>##                                                                        
##              [Moby Dick, 16994]    all over like a Newfoundland | dog |
##              [Moby Dick, 31496]        was seen swimming like a | dog |
##              [Moby Dick, 59413]                    last.- Down, | dog |
##              [Moby Dick, 59514]          not tamely be called a | dog |
##              [Moby Dick, 60031]             didn't he call me a | dog |
##              [Moby Dick, 86276]   sacrifice of the sacred White | Dog |
##             [Moby Dick, 124777]            life that lives in a | dog |
##             [Moby Dick, 124873]   the sagacious kindness of the | dog |
##             [Moby Dick, 158480] " The ungracious and ungrateful | dog |
##             [Moby Dick, 158520]           Give way, greyhounds! | Dog |
##             [Moby Dick, 169781]             to the whale that a | dog |
##             [Moby Dick, 192916]           or the Ram- lecherous | dog |
##             [Moby Dick, 196440]                  .( Bunger, you | dog |
##             [Moby Dick, 196913]              die in pickle, you | dog |
##             [Moby Dick, 197537]                Ahab, and like a | dog |
##             [Moby Dick, 239480]       air as a sagacious ship's | dog |
##  [Sense and Sensibility, 77978]        fellow! such a deceitful | dog |
##                            
##  just from the water,      
##  , throwing his long arms  
##  , and kennel!"            
##  , sir.""                  
##  ? blazes! he called       
##  was by far the holiest    
##  or a horse. Indeed        
##  ? The accursed shark alone
##  !" cried Starbuck;        
##  to it!""                  
##  does to the elephant;     
##  , he begets us;           
##  , laugh out! why          
##  ; you should be preserved 
##  , strangely snuffing;"    
##  will, in drawing nigh     
##  ! It was only the</code></pre>
<p>We can plot this easily too, as a lexical dispersion plot. By specifying the scale as “absolute”, we are looking at absolute token index position rather than relative position, and therefore we see that <em>Moby Dick</em> is nearly twice as long as <em>Sense and Sensibility</em>.</p>
<div class="sourceCode" id="cb118"><html><body><pre class="r"><span class="fu"><a href="../../../reference/textplot_xray.html">textplot_xray</a></span>(<span class="no">dogkwic</span>, <span class="kw">scale</span> <span class="kw">=</span> <span class="st">"absolute"</span>)</pre></body></html></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-45-1.png" width="768"></p>
</div>
<div id="text-quality-text-variety-and-parsing-xml" class="section level1">
<h1 class="hasAnchor">
<a href="#text-quality-text-variety-and-parsing-xml" class="anchor"></a>10 Text Quality, Text Variety, and Parsing XML</h1>
</div>
<div id="clustering" class="section level1">
<h1 class="hasAnchor">
<a href="#clustering" class="anchor"></a>11 Clustering</h1>
<p>Chapter 11 describes how to detect clusters in a corpus. While the book uses the <code>XMLAuthorCorpus</code>, we describe clustering using U.S. State of the Union addresses included in the <strong>quanteda.corpora</strong> package. We trim the corpus with <code><a href="../../../reference/dfm_trim.html">dfm_trim()</a></code> by keeping only those words that occur at least five times in the corpus and in at least three speeches.</p>
<div class="sourceCode" id="cb119"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">quanteda.corpora</span>)
<span class="no">pres_dfm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/dfm.html">dfm</a></span>(<span class="fu"><a href="../../../reference/corpus_subset.html">corpus_subset</a></span>(<span class="no">data_corpus_sotu</span>, <span class="no">Date</span> <span class="kw">&gt;</span> <span class="st">"1980-01-01"</span>),
               <span class="kw">stem</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">remove_punct</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
               <span class="kw">remove</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stopwords/man/stopwords.html">stopwords</a></span>(<span class="st">"english"</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../../../reference/dfm_trim.html">dfm_trim</a></span>(<span class="kw">min_termfreq</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">min_docfreq</span> <span class="kw">=</span> <span class="fl">3</span>)

<span class="co"># hierarchical clustering - get distances on normalized dfm</span>
<span class="no">pres_dist_mat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_weight.html">dfm_weight</a></span>(<span class="no">pres_dfm</span>, <span class="kw">scheme</span> <span class="kw">=</span> <span class="st">"prop"</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../../../reference/textstat_simil.html">textstat_dist</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">"euclidean"</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span>()

<span class="co"># hiarchical clustering the distance object</span>
<span class="no">pres_cluster</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span>(<span class="no">pres_dist_mat</span>)

<span class="co"># label with document names</span>
<span class="no">pres_cluster</span>$<span class="no">labels</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/docnames.html">docnames</a></span>(<span class="no">pres_dfm</span>)

<span class="co"># plot as a dendrogram</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">pres_cluster</span>, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">sub</span> <span class="kw">=</span> <span class="st">""</span>,
     <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Euclidean Distance on Normalized Token Frequency"</span>)</pre></body></html></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-46-1.png" width="700"></p>
</div>
<div id="classification" class="section level1">
<h1 class="hasAnchor">
<a href="#classification" class="anchor"></a>12 Classification</h1>
</div>
<div id="topic-modelling" class="section level1">
<h1 class="hasAnchor">
<a href="#topic-modelling" class="anchor"></a>13 Topic Modelling</h1>
<p>Finally, Jockers’ book introduces topic modelling of a corpus and the visualisation through wordclouds. We can easily apply functions from the <strong>topicmodels</strong> package by using <strong>quanteda</strong>’s <code><a href="../../../reference/convert.html">convert()</a></code> function. In our example, we use the Irish budget speeches from 2010 (<code>data_corpus_irishbudget2010</code>) and classify 20 topics using Latent Dirichlet Allocation.</p>
<div class="sourceCode" id="cb120"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">data_corpus_irishbudget2010</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"quanteda.textmodels"</span>)
<span class="no">dfm_speeches</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/dfm.html">dfm</a></span>(<span class="no">data_corpus_irishbudget2010</span>,
                <span class="kw">remove_punct</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">remove_numbers</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                <span class="kw">remove</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stopwords/man/stopwords.html">stopwords</a></span>(<span class="st">"english"</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../../../reference/dfm_trim.html">dfm_trim</a></span>(<span class="kw">min_termfreq</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">max_docfreq</span> <span class="kw">=</span> <span class="fl">10</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">topicmodels</span>)
<span class="no">LDA_fit_20</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/convert.html">convert</a></span>(<span class="no">dfm_speeches</span>, <span class="kw">to</span> <span class="kw">=</span> <span class="st">"topicmodels"</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/topicmodels/man/lda.html">LDA</a></span>(<span class="kw">k</span> <span class="kw">=</span> <span class="fl">20</span>)

<span class="co"># get top five terms per topic</span>
<span class="fu"><a href="https://rdrr.io/pkg/topicmodels/man/get.html">get_terms</a></span>(<span class="no">LDA_fit_20</span>, <span class="fl">5</span>)</pre></body></html></div>
<pre><code>##      Topic 1    Topic 2    Topic 3   Topic 4     Topic 5   Topic 6    
## [1,] "parties"  "million"  "million" "failed"    "levy"    "taoiseach"
## [2,] "gael"     "spending" "review"  "strategy"  "million" "employees"
## [3,] "spending" "pension"  "welfare" "needed"    "carbon"  "rate"     
## [4,] "taxation" "scheme"   "reduce"  "ministers" "change"  "referred" 
## [5,] "per"      "system"   "tourism" "system"    "welfare" "debate"   
##      Topic 7      Topic 8      Topic 9       Topic 10       Topic 11 Topic 12  
## [1,] "support"    "investment" "kind"        "society"      "fianna" "fianna"  
## [2,] "welfare"    "measures"   "imagination" "enterprising" "fáil"   "fáil"    
## [3,] "adjustment" "scheme"     "policies"    "sense"        "side"   "national"
## [4,] "million"    "level"      "wit"         "equal"        "level"  "irish"   
## [5,] "irish"      "welfare"    "create"      "nation"       "third"  "support" 
##      Topic 13      Topic 14   Topic 15  Topic 16  Topic 17    Topic 18     
## [1,] "alternative" "welfare"  "child"   "child"   "taoiseach" "continue"   
## [2,] "citizenship" "system"   "place"   "benefit" "fine"      "investment" 
## [3,] "wealth"      "fianna"   "believe" "day"     "gael"      "million"    
## [4,] "adjustment"  "fáil"     "system"  "today"   "may"       "scheme"     
## [5,] "breaks"      "stimulus" "welfare" "bank"    "irish"     "development"
##      Topic 19     Topic 20   
## [1,] "support"    "care"     
## [2,] "million"    "welfare"  
## [3,] "including"  "per"      
## [4,] "enterprise" "allowance"
## [5,] "back"       "hit"</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kenneth Benoit, Kohei Watanabe, Haiyan Wang, Paul Nulty, Adam Obeng, Stefan Müller, Akitaka Matsuo, Jiong Wei Lua, Jouni Kuha, William Lowe, European Research Council.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '9b4ef7fd791dc6075154d3ebd7b12acf',
    indexName: 'quanteda',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
