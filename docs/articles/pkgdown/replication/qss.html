<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Replication of Chapter 5 of _Quantitative Social Science: An Introduction_ • quanteda</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../../bootstrap-toc.css">
<script src="../../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../../pkgdown.css" rel="stylesheet">
<script src="../../../pkgdown.js"></script><!-- docsearch --><script src="../../../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../../../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../../../extra.css" rel="stylesheet">
<script src="../../../extra.js"></script><meta property="og:title" content="Replication of Chapter 5 of _Quantitative Social Science: An Introduction_">
<meta property="og:description" content="quanteda">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-144616-24"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-144616-24');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../../index.html">quanteda</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Quick Start
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/quickstart.html">Quick Start Guide</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/quickstart_es.html">Guía de Inicio Rápido</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/quickstart_cn.html">快速入门指南</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/quickstart_ja.html">クイック・スタートガイド</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/quickstart_hi.html">त्वरित आरंभ </a>
    </li>
  </ul>
</li>
<li>
  <a href="../../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Features
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/pkgdown/comparison.html">Feature comparison</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/design.html">Package design</a>
    </li>
    <li>
      <a href="../../../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/pkgdown/examples/phrase.html">Multi-word expressions</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/plotting.html">Textual data visualization</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/lsa.html">Latent Semantic Analysis (LSA)</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/chinese.html">Chinese text analysis</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/twitter.html">Social media analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Replications
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/pkgdown/replication/digital-humanities.html">Text Analysis with R for Students of Literature</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/replication/text2vec.html">Word embedding (word2vec)</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/replication/qss.html">Quantitative Social Science Ch. 5.1</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/quanteda/quanteda">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="qss_files/header-attrs-2.3/header-attrs.js"></script><script src="qss_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Replication of Chapter 5 of <em>Quantitative Social Science: An Introduction</em>
</h1>
                        <h4 class="author">Stefan Müller and Kenneth Benoit</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/quanteda/quanteda/blob/master/vignettes/pkgdown/replication/qss.Rmd"><code>vignettes/pkgdown/replication/qss.Rmd</code></a></small>
      <div class="hidden name"><code>qss.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"quanteda"</span>)</pre></body></html></div>
<p>In this vignette we show how the <strong>quanteda</strong> package can be used to replicate the text analysis part (Chapter 5.1) from Kosuke Imai’s book <a href="http://qss.princeton.press"><em>Quantitative Social Science: An Introduction</em></a> (Princeton: Princeton University Press, 2017).</p>
<div id="download-the-corpus" class="section level2">
<h2 class="hasAnchor">
<a href="#download-the-corpus" class="anchor"></a>Download the Corpus</h2>
<p>To get the textual data, you need to install and load the <strong>qss</strong> package first that comes with the book.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"kosukeimai/qss-package"</span>, <span class="kw">build_vignettes</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
</div>
<div id="section-5-1-1-the-disputed-authorship-of-the-federalist-papers" class="section level2">
<h2 class="hasAnchor">
<a href="#section-5-1-1-the-disputed-authorship-of-the-federalist-papers" class="anchor"></a>Section 5.1.1: The Disputed Authorship of ‘The Federalist Papers’</h2>
<p>First, we use the <strong>readtext</strong> package to import the Federalist Papers as a data frame and create a <strong>quanteda</strong> corpus.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"readtext"</span>)
<span class="co"># use readtext package to import all documents as a dataframe</span>
<span class="no">corpus_texts</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/federalist/"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"qss"</span>))

<span class="co"># create docvar with number of paper</span>
<span class="no">corpus_texts</span>$<span class="no">paper_number</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"No."</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">corpus_texts</span>)), <span class="kw">sep</span> <span class="kw">=</span> <span class="st">" "</span>)

<span class="co"># transform to a quanteda corpus object</span>
<span class="no">corpus_raw</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/corpus.html">corpus</a></span>(<span class="no">corpus_texts</span>, <span class="kw">text_field</span> <span class="kw">=</span> <span class="st">"text"</span>, <span class="kw">docid_field</span> <span class="kw">=</span> <span class="st">"paper_number"</span>)

<span class="co"># create docvar with authorship (used in Section  5.1.4)</span>
<span class="fu"><a href="../../../reference/docvars.html">docvars</a></span>(<span class="no">corpus_raw</span>, <span class="st">"paper_numeric"</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fu"><a href="../../../reference/ndoc.html">ndoc</a></span>(<span class="no">corpus_raw</span>))

<span class="co"># create docvar with authorship (used in Section  5.1.4)</span>
<span class="fu"><a href="../../../reference/docvars.html">docvars</a></span>(<span class="no">corpus_raw</span>, <span class="st">"author"</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="fl">NA</span>, <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"madison"</span>, <span class="st">"hamilton"</span>))
<span class="fu"><a href="../../../reference/docvars.html">docvars</a></span>(<span class="no">corpus_raw</span>, <span class="st">"author"</span>)[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">6</span>:<span class="fl">9</span>, <span class="fl">11</span>:<span class="fl">13</span>, <span class="fl">15</span>:<span class="fl">17</span>, <span class="fl">21</span>:<span class="fl">36</span>, <span class="fl">59</span>:<span class="fl">61</span>, <span class="fl">65</span>:<span class="fl">85</span>)] <span class="kw">&lt;-</span> <span class="st">"hamilton"</span>
<span class="fu"><a href="../../../reference/docvars.html">docvars</a></span>(<span class="no">corpus_raw</span>, <span class="st">"author"</span>)[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10</span>, <span class="fl">14</span>, <span class="fl">37</span>:<span class="fl">48</span>, <span class="fl">58</span>)] <span class="kw">&lt;-</span> <span class="st">"madison"</span></pre></body></html></div>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># inspect Paper No. 10 (output suppressed)</span>
<span class="fu"><a href="../../../reference/texts.html">texts</a></span>(<span class="no">corpus_raw</span>)[<span class="fl">10</span>] <span class="kw">%&gt;%</span>
    <span class="kw pkg">stringi</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_sub.html">stri_sub</a></span>(<span class="fl">1</span>, <span class="fl">240</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>()</pre></body></html></div>
<pre><code>## AMONG the numerous advantages promised by a well-constructed Union, none 
##         deserves to be more accurately developed than its tendency to break and 
##         control the violence of faction. The friend of popular governments never 
## </code></pre>
</div>
<div id="section-5-1-2-document-term-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#section-5-1-2-document-term-matrix" class="anchor"></a>Section 5.1.2: Document-Term Matrix</h2>
<p>Next, we transform the corpus to a document-feature matrix. <code>dfm_prep</code> (used in sections 5.1.4 and 5.1.5) is a dfm in which numbers and punctuation have been removed, and in which terms have been converted to lowercase. In <code>dfm_papers</code>, the words have also been stemmed and a standard set of stopwords removed.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># transform corpus to a document-feature matrix</span>
<span class="no">dfm_prep</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/dfm.html">dfm</a></span>(<span class="no">corpus_raw</span>, <span class="kw">remove_numbers</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">tolower</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                <span class="kw">remove_punct</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>## Creating a dfm from a corpus input...</code></pre>
<pre><code>##  ...lowercasing</code></pre>
<pre><code>##  ...found 85 documents, 8,631 features</code></pre>
<pre><code>##  ...complete, elapsed time: 0.578 seconds.</code></pre>
<pre><code>## Finished constructing a 85 x 8,631 sparse dfm.</code></pre>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># remove stop words and stem words</span>
<span class="no">dfm_papers</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/dfm.html">dfm</a></span>(<span class="no">dfm_prep</span>, <span class="kw">stem</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">remove</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stopwords/man/stopwords.html">stopwords</a></span>(<span class="st">"english"</span>))

<span class="co"># inspect</span>
<span class="no">dfm_papers</span></pre></body></html></div>
<pre><code>## Document-feature matrix of: 85 documents, 4,860 features (89.1% sparse) and 3 docvars.
##        features
## docs    unequivoc experi ineffici subsist feder govern call upon deliber new
##   No. 1         1      1        1       1     1      9    1    6       3   5
##   No. 2         0      3        0       0     2      9    1    1       1   2
##   No. 3         0      1        0       0     2     20    0    0       0   1
##   No. 4         0      2        0       0     0     21    1    0       0   0
##   No. 5         0      1        0       0     0      3    0    0       0   0
##   No. 6         0      3        0       0     0      4    0    4       0   1
## [ reached max_ndoc ... 79 more documents, reached max_nfeat ... 4,850 more features ]</code></pre>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="co"># sort into alphabetical order of features, to match book example</span>
<span class="no">dfm_papers</span> <span class="kw">&lt;-</span> <span class="no">dfm_papers</span>[, <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span>(<span class="fu"><a href="../../../reference/featnames.html">featnames</a></span>(<span class="no">dfm_papers</span>))]

<span class="co"># inspect some documents in the dfm</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">dfm_papers</span>, <span class="kw">nf</span> <span class="kw">=</span> <span class="fl">8</span>)</pre></body></html></div>
<pre><code>## Document-feature matrix of: 6 documents, 8 features (97.9% sparse) and 3 docvars.
##        features
## docs    ` 1st 2d 3d 4th 5th abandon abat
##   No. 1 0   0  0  0   0   0       0    0
##   No. 2 0   0  0  0   0   0       0    0
##   No. 3 0   0  0  0   0   0       0    0
##   No. 4 0   0  0  0   0   0       0    0
##   No. 5 0   1  0  0   0   0       0    0
##   No. 6 0   0  0  0   0   0       0    0</code></pre>
<p>The <strong>tm</strong> package considers features such as “1st” to be numbers, whereas <strong>quanteda</strong> does not. We can remove these easily using a wildcard removal:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">dfm_papers</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_select.html">dfm_remove</a></span>(<span class="no">dfm_papers</span>, <span class="st">"[0-9]"</span>, <span class="kw">valuetype</span> <span class="kw">=</span> <span class="st">"regex"</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>## removed 5 features</code></pre>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">dfm_papers</span>, <span class="kw">nf</span> <span class="kw">=</span> <span class="fl">8</span>)</pre></body></html></div>
<pre><code>## Document-feature matrix of: 6 documents, 8 features (97.9% sparse) and 3 docvars.
##        features
## docs    ` abandon abat abb abet abhorr abil abject
##   No. 1 0       0    0   0    0      0    0      0
##   No. 2 0       0    0   0    0      0    1      0
##   No. 3 0       0    0   0    0      0    0      0
##   No. 4 0       0    0   0    0      0    0      0
##   No. 5 0       0    0   0    0      0    0      0
##   No. 6 0       0    0   0    0      0    0      0</code></pre>
</div>
<div id="section-5-1-3-topic-discovery" class="section level2">
<h2 class="hasAnchor">
<a href="#section-5-1-3-topic-discovery" class="anchor"></a>Section 5.1.3: Topic Discovery</h2>
<p>We can use the <code><a href="../../../reference/textplot_wordcloud.html">textplot_wordcloud()</a></code> function to plot word clouds of the most frequent words in Papers 12 and 24.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">100</span>)
<span class="fu"><a href="../../../reference/textplot_wordcloud.html">textplot_wordcloud</a></span>(<span class="no">dfm_papers</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"No. 12"</span>, <span class="st">"No. 24"</span>), ],
                   <span class="kw">max.words</span> <span class="kw">=</span> <span class="fl">50</span>, <span class="kw">comparison</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="qss_files/figure-html/unnamed-chunk-8-1.png" width="768"></p>
<p>Since <strong>quanteda</strong> cannot do stem completion, we will skip that part.</p>
<p>Next, we identify clusters of similar essay based on term frequency-inverse document frequency (<em>tf-idf</em>) and apply the <span class="math inline">\(k\)</span>-means algorithm to the weighted dfm.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="co"># tf-idf calculation</span>
<span class="no">dfm_papers_tfidf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_tfidf.html">dfm_tfidf</a></span>(<span class="no">dfm_papers</span>, <span class="kw">base</span> <span class="kw">=</span> <span class="fl">2</span>)

<span class="co"># 10 most important words for Paper No. 12</span>
<span class="fu"><a href="../../../reference/topfeatures.html">topfeatures</a></span>(<span class="no">dfm_papers_tfidf</span>[<span class="fl">12</span>, ], <span class="kw">n</span> <span class="kw">=</span> <span class="fl">10</span>)</pre></body></html></div>
<pre><code>##     revenu contraband     patrol      excis      coast      trade        per 
##   19.42088   19.22817   19.22817   19.12214   16.22817   15.01500   14.47329 
##        tax       cent     gallon 
##   13.20080   12.81878   12.81878</code></pre>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="co"># 10 most important words for Paper No. 24</span>
<span class="fu"><a href="../../../reference/topfeatures.html">topfeatures</a></span>(<span class="no">dfm_papers_tfidf</span>[<span class="fl">24</span>, ], <span class="kw">n</span> <span class="kw">=</span> <span class="fl">10</span>)</pre></body></html></div>
<pre><code>##   garrison  dock-yard settlement      spain       armi   frontier    arsenal 
##  24.524777  19.228173  16.228173  13.637564  12.770999  12.262389  10.818782 
##    western       post     nearer 
##  10.806108  10.228173   9.648857</code></pre>
<p>We can match the clustering as follows:</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">k</span> <span class="kw">&lt;-</span> <span class="fl">4</span>  <span class="co"># number of clusters</span>

<span class="co"># subset The Federalist papers written by Hamilton</span>

<span class="no">dfm_papers_tfidf_hamilton</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_subset.html">dfm_subset</a></span>(<span class="no">dfm_papers_tfidf</span>, <span class="no">author</span> <span class="kw">==</span> <span class="st">"hamilton"</span>)

<span class="co"># run k-means</span>
<span class="no">km_out</span> <span class="kw">&lt;-</span> <span class="kw pkg">stats</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span>(<span class="no">dfm_papers_tfidf_hamilton</span>, <span class="kw">centers</span> <span class="kw">=</span> <span class="no">k</span>)

<span class="no">km_out</span>$<span class="no">iter</span> <span class="co"># check the convergence; number of iterations may vary</span></pre></body></html></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">km_out</span>$<span class="no">centers</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/featnames.html">featnames</a></span>(<span class="no">dfm_papers_tfidf_hamilton</span>)

<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">k</span>) { <span class="co"># loop for each cluster</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"CLUSTER"</span>, <span class="no">i</span>, <span class="st">"\n"</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"Top 10 words:\n"</span>) <span class="co"># 10 most important terms at the centroid</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="no">km_out</span>$<span class="no">centers</span>[<span class="no">i</span>, ], <span class="kw">decreasing</span> <span class="kw">=</span> <span class="fl">TRUE</span>), <span class="kw">n</span> <span class="kw">=</span> <span class="fl">10</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"\n"</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"Federalist Papers classified: \n"</span>) <span class="co"># extract essays classified</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="../../../reference/docnames.html">docnames</a></span>(<span class="no">dfm_papers_tfidf_hamilton</span>)[<span class="no">km_out</span>$<span class="no">cluster</span> <span class="kw">==</span> <span class="no">i</span>])
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"\n"</span>)
}</pre></body></html></div>
<pre><code>## CLUSTER 1 
## Top 10 words:
##     armi  militia   revenu militari      war    trade    taxat     upon 
## 6.271473 5.204072 4.634529 4.413837 4.349851 4.222969 4.065847 4.049374 
##     land      tax 
## 4.007387 3.889522 
## 
## Federalist Papers classified: 
##  [1] "No. 6"  "No. 7"  "No. 8"  "No. 11" "No. 12" "No. 15" "No. 21" "No. 22"
##  [9] "No. 24" "No. 25" "No. 26" "No. 29" "No. 30" "No. 34" "No. 35" "No. 36"
## 
## CLUSTER 2 
## Top 10 words:
##       juri      trial      court     crimin  admiralti     equiti   chanceri 
##  218.20102   84.74567   62.47940   42.06871   40.87463   38.24428   37.86574 
## common-law     probat      civil 
##   27.04695   27.04695   26.77843 
## 
## Federalist Papers classified: 
## [1] "No. 83"
## 
## CLUSTER 3 
## Top 10 words:
##     court     appel jurisdict    suprem      juri    tribun    cogniz  inferior 
##  69.68857  35.27513  25.46591  24.79126  22.16104  21.27125  19.12214  18.76875 
##    appeal re-examin 
##  16.21098  13.52348 
## 
## Federalist Papers classified: 
## [1] "No. 81" "No. 82"
## 
## CLUSTER 4 
## Top 10 words:
##    senat   presid    claus     upon    court governor    offic  appoint 
## 5.459987 4.228173 3.530536 3.456783 3.254136 3.134332 3.071945 2.823580 
##  impeach    nomin 
## 2.737110 2.658907 
## 
## Federalist Papers classified: 
##  [1] "No. 1"  "No. 9"  "No. 13" "No. 16" "No. 17" "No. 23" "No. 27" "No. 28"
##  [9] "No. 31" "No. 32" "No. 33" "No. 59" "No. 60" "No. 61" "No. 65" "No. 66"
## [17] "No. 67" "No. 68" "No. 69" "No. 70" "No. 71" "No. 72" "No. 73" "No. 74"
## [25] "No. 75" "No. 76" "No. 77" "No. 78" "No. 79" "No. 80" "No. 84" "No. 85"</code></pre>
</div>
<div id="section-5-1-4-authorship-prediction" class="section level2">
<h2 class="hasAnchor">
<a href="#section-5-1-4-authorship-prediction" class="anchor"></a>Section 5.1.4: Authorship Prediction</h2>
<p>In a next step, we want to predict authorship for the Federalist Papers whose authorship is unknown. As the topics of the Papers differs remarkably, Imai focuses on 10 articles, prepositions and conjunctions to predict authorship.</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="co"># term frequency per 1000 words</span>
<span class="no">tfm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_weight.html">dfm_weight</a></span>(<span class="no">dfm_prep</span>, <span class="st">"prop"</span>) * <span class="fl">1000</span>

<span class="co"># select words of interest</span>
<span class="no">words</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"although"</span>, <span class="st">"always"</span>, <span class="st">"commonly"</span>, <span class="st">"consequently"</span>,
           <span class="st">"considerable"</span>, <span class="st">"enough"</span>, <span class="st">"there"</span>, <span class="st">"upon"</span>, <span class="st">"while"</span>, <span class="st">"whilst"</span>)
<span class="no">tfm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_select.html">dfm_select</a></span>(<span class="no">tfm</span>, <span class="no">words</span>, <span class="kw">valuetype</span> <span class="kw">=</span> <span class="st">"fixed"</span>)

<span class="co"># average among Hamilton/Madison essays</span>
<span class="no">tfm_ave</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_group.html">dfm_group</a></span>(<span class="fu"><a href="../../../reference/dfm_subset.html">dfm_subset</a></span>(<span class="no">tfm</span>, !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">author</span>)), <span class="st">"author"</span>) /
           <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="fu"><a href="../../../reference/docvars.html">docvars</a></span>(<span class="no">tfm</span>, <span class="st">"author"</span>)))

<span class="co"># bind docvars from corpus and tfm to a data frame</span>
<span class="no">author_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu"><a href="../../../reference/docvars.html">docvars</a></span>(<span class="no">corpus_raw</span>), <span class="no">tfm</span>)</pre></body></html></div>
<pre><code>## Warning: 'as.data.frame.dfm' is deprecated.
## Use 'convert(x, to = "data.frame")' instead.
## See help("Deprecated")</code></pre>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="co"># create numeric variable that takes value 1 for Hamilton's essays,</span>
<span class="co"># -1 for Madison's essays and NA for the essays with unknown authorship</span>
<span class="no">author_data</span>$<span class="no">author_numeric</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">author_data</span>$<span class="no">author</span> <span class="kw">==</span> <span class="st">"hamilton"</span>, <span class="fl">1</span>,
                                     <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">author_data</span>$<span class="no">author</span> <span class="kw">==</span> <span class="st">"madison"</span>, -<span class="fl">1</span>, <span class="fl">NA</span>))

<span class="co"># use only known authors for training set</span>
<span class="no">author_data_known</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>(<span class="no">author_data</span>)

<span class="no">hm_fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">author_numeric</span> ~ <span class="no">upon</span> + <span class="no">there</span> + <span class="no">consequently</span> + <span class="no">whilst</span>,
             <span class="kw">data</span> <span class="kw">=</span> <span class="no">author_data_known</span>)
<span class="no">hm_fit</span></pre></body></html></div>
<pre><code>## 
## Call:
## lm(formula = author_numeric ~ upon + there + consequently + whilst, 
##     data = author_data_known)
## 
## Coefficients:
##  (Intercept)          upon         there  consequently        whilst  
##      -0.2728        0.2240        0.1278       -0.5597       -0.8379</code></pre>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="no">hm_fitted</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span>(<span class="no">hm_fit</span>) <span class="co"># fitted values</span>
<span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">hm_fitted</span>)</pre></body></html></div>
<pre><code>## [1] 0.7175463</code></pre>
</div>
<div id="section-5-1-5-cross-validation" class="section level2">
<h2 class="hasAnchor">
<a href="#section-5-1-5-cross-validation" class="anchor"></a>Section 5.1.5: Cross-Validation</h2>
<p>Finally, we assess how well the model fits the data by classifying each essay based on its fitted value.</p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="co"># proportion of correctly classified essays by Hamilton</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">hm_fitted</span>[<span class="no">author_data_known</span>$<span class="no">author</span> <span class="kw">==</span> <span class="st">"hamilton"</span>] <span class="kw">&gt;</span> <span class="fl">0</span>)</pre></body></html></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="co"># proportion of correctly classified essays by Madison</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">hm_fitted</span>[<span class="no">author_data_known</span>$<span class="no">author</span> <span class="kw">==</span> <span class="st">"madison"</span>] <span class="kw">&lt;</span> <span class="fl">0</span>)</pre></body></html></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="no">n</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">author_data_known</span>)
<span class="no">hm_classify</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">NA</span>, <span class="no">n</span>) <span class="co"># a container vector with missing values</span>

<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">n</span>) {
  <span class="co"># fit the model to the data after removing the ith observation</span>
  <span class="no">sub_fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">author_numeric</span> ~ <span class="no">upon</span> + <span class="no">there</span> + <span class="no">consequently</span> + <span class="no">whilst</span>,
                <span class="kw">data</span> <span class="kw">=</span> <span class="no">author_data_known</span>[-<span class="no">i</span>, ]) <span class="co"># exclude ith row</span>
  <span class="co"># predict the authorship for the ith observation</span>
  <span class="no">hm_classify</span>[<span class="no">i</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">sub_fit</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">author_data_known</span>[<span class="no">i</span>, ])
}

<span class="co"># proportion of correctly classified essays by Hamilton</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">hm_classify</span>[<span class="no">author_data_known</span>$<span class="no">author</span> <span class="kw">==</span> <span class="st">"hamilton"</span>] <span class="kw">&gt;</span> <span class="fl">0</span>)</pre></body></html></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="co"># proportion of correctly classified essays by Madison</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">hm_classify</span>[<span class="no">author_data_known</span>$<span class="no">author</span> <span class="kw">==</span> <span class="st">"madison"</span>] <span class="kw">&lt;</span> <span class="fl">0</span>)</pre></body></html></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="no">disputed</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">49</span>, <span class="fl">50</span>:<span class="fl">57</span>, <span class="fl">62</span>, <span class="fl">63</span>) <span class="co"># 11 essays with disputed authorship</span>
<span class="no">tf_disputed</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_subset.html">dfm_subset</a></span>(<span class="no">tfm</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">author</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../../../reference/convert.html">convert</a></span>(<span class="kw">to</span> <span class="kw">=</span> <span class="st">"data.frame"</span>)

<span class="no">author_data</span>$<span class="no">prediction</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">hm_fit</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">author_data</span>)

<span class="no">author_data</span>$<span class="no">prediction</span> <span class="co"># predicted values</span></pre></body></html></div>
<pre><code>##  [1]  0.73688561 -0.13805744 -1.35078839 -0.03818220 -0.27281185  0.71544514
##  [7]  1.33186598  0.19419487  0.37522873 -0.20366262  0.67591728  0.99485942
## [13]  1.39358870 -1.18910700  1.20454811  0.64005758  0.91397681 -0.38337508
## [19] -0.62468302 -0.12449276  0.91560123  1.08105705  0.88535667  1.01199958
## [25]  0.08231865  0.72345360  1.08185398  0.71361766  1.47727897  1.53681013
## [31]  1.85581851  0.71928207  1.07671057  1.26171629  0.90807385  1.06348441
## [37] -0.81827318 -0.56125155 -0.27281185 -0.10304108 -0.47339830 -0.17488801
## [43] -0.60651986 -0.86943120 -1.67771035 -0.91485858 -0.13263458 -0.13495322
## [49] -0.96785069 -0.06902493 -1.46794406 -0.27281185 -0.54226168 -0.54530152
## [55]  0.04087236 -0.56414912 -1.18176926 -0.41900312  0.55206970  0.98683635
## [61]  0.59244239 -0.97797908 -0.21198475 -0.18292385  1.15647955  1.12410607
## [67]  0.78355251  0.11202677  1.12627538  0.70796660  0.34757045  0.84264937
## [73]  1.24189733  0.91619843  0.50283000  1.05488104  1.05933797  0.90593132
## [79]  0.54299626  0.64042173  0.91780877  0.31194485  0.80874960  0.73655199
## [85]  1.00901860</code></pre>
<p>Finally, we plot the fitted values for each Federalist paper with the <strong>ggplot2</strong> package.</p>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="no">author_data</span>$<span class="no">author_plot</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">author_data</span>$<span class="no">author</span>), <span class="st">"unknown"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">author_data</span>$<span class="no">author</span>))

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">author_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">paper_numeric</span>,
                               <span class="kw">y</span> <span class="kw">=</span> <span class="no">prediction</span>,
                               <span class="kw">shape</span> <span class="kw">=</span> <span class="no">author_plot</span>,
                               <span class="kw">colour</span> <span class="kw">=</span> <span class="no">author_plot</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">"dotted"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Federalist Papers"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Predicted values"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>() +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.title</span><span class="kw">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>())</pre></body></html></div>
<p><img src="qss_files/figure-html/unnamed-chunk-13-1.png" width="768"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kenneth Benoit, Kohei Watanabe, Haiyan Wang, Paul Nulty, Adam Obeng, Stefan Müller, Akitaka Matsuo, Jiong Wei Lua, Jouni Kuha, William Lowe, European Research Council.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '9b4ef7fd791dc6075154d3ebd7b12acf',
    indexName: 'quanteda',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
